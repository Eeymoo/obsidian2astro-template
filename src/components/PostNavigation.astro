---
import type { CollectionEntry } from "astro:content";
import { getCollection } from "astro:content";
import { filterContent, generatePostSlug } from "../utils";

export interface Props {
  currentPost: CollectionEntry<"blog"> | {
    id: string;
    collection: "blog";
    data: any;
    originalId?: string;
  };
}

const { currentPost } = Astro.props;

// 获取所有文章并按日期排序
const allPosts = filterContent(await getCollection("blog"))
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());

// 找到当前文章的索引
const currentIndex = allPosts.findIndex(post => post.id === currentPost.id);

// 获取上一篇和下一篇文章
const prevPost = currentIndex < allPosts.length - 1 ? allPosts[currentIndex + 1] : null;
const nextPost = currentIndex > 0 ? allPosts[currentIndex - 1] : null;
---

<nav class="post-navigation mt-12 pt-8 border-t border-gray-200 dark:border-gray-700">
  <div class="flex justify-between items-center">
    <!-- 上一篇 -->
    {prevPost && (
      <div class="prev-post text-left max-w-md">
        <a href={`/post/${generatePostSlug(prevPost)}.html`} 
           class="group block p-4 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
          <div class="text-sm text-gray-500 dark:text-gray-400 mb-2 flex items-center">
            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
            上一篇
          </div>
          <h3 class="text-base font-medium text-gray-900 dark:text-white group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors line-clamp-2">
            {prevPost.data.title}
          </h3>
          <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
            {prevPost.data.date.toLocaleDateString('zh-CN')}
          </div>
        </a>
      </div>
    )}
    
    <!-- 下一篇 -->
    {nextPost && (
      <div class="next-post text-right max-w-md ml-auto">
        <a href={`/post/${generatePostSlug(nextPost)}.html`} 
           class="group block p-4 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
          <div class="text-sm text-gray-500 dark:text-gray-400 mb-2 flex items-center justify-end">
            下一篇
            <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </div>
          <h3 class="text-base font-medium text-gray-900 dark:text-white group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors line-clamp-2">
            {nextPost.data.title}
          </h3>
          <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
            {nextPost.data.date.toLocaleDateString('zh-CN')}
          </div>
        </a>
      </div>
    )}
  </div>
</nav>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  /* 当只有上一篇文章时，居中显示 */
  .post-navigation .prev-post:only-child {
    margin: 0 auto;
    text-align: center;
  }
  
  .post-navigation .prev-post:only-child a {
    display: inline-block;
    text-align: center;
  }
  
  .post-navigation .prev-post:only-child .flex {
    justify-content: center;
  }
  
  .post-navigation .prev-post:only-child svg {
    transform: rotate(180deg);
  }
</style>