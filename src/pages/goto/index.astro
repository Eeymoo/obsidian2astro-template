---
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../../consts';
import '../../styles/global.css';
---

<!doctype html>
<html lang="zh-CN" class="scroll-smooth">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
    <script>
      // é˜²æ­¢é—ªçƒï¼šåœ¨é¡µé¢åŠ è½½å‰è®¾ç½®ä¸»é¢˜
      const savedTheme = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const isDark = savedTheme === 'dark' || (!savedTheme && prefersDark);
      if (isDark) {
        document.documentElement.classList.add('dark');
      }
    </script>
  </head>
  <body>
    <Header />
    <main class="w-full max-w-2xl mx-auto px-4 py-16 min-h-screen flex flex-col justify-center">
      <!-- å€’è®¡æ—¶åŒºåŸŸ - é«˜ä¼˜å…ˆçº§å±•ç¤º -->
      <div id="countdownContainer" class="mb-12">
        <div class="text-center">
          <div class="inline-flex items-center justify-center w-40 h-40 rounded-full bg-gradient-to-br from-primary via-primary/80 to-primary/60 shadow-lg mb-6">
            <span id="countdown" class="text-8xl font-bold text-white drop-shadow-md">3</span>
          </div>
          <p class="text-2xl font-semibold text-gray-900 dark:text-white mt-4">ç§’åè·³è½¬</p>
        </div>
      </div>

      <!-- URL å±•ç¤ºåŒºåŸŸ - çªå‡º -->
      <div class="mb-8 p-6 bg-primary/5 dark:bg-primary/10 border-2 border-primary/30 dark:border-primary/40 rounded-lg">
        <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">ç›®æ ‡ç½‘å€</p>
        <p id="urlDisplay" class="text-lg md:text-xl font-semibold text-primary break-all leading-relaxed">
          è·å–ä¸­...
        </p>
      </div>

      <!-- é¡µé¢æ ‡é¢˜ -->
      <h1 class="text-4xl md:text-5xl font-bold text-center mb-6 text-gray-900 dark:text-white">
        ğŸŒ é‡å®šå‘ä¸­
      </h1>

      <!-- æè¿°æ–‡æœ¬ -->
      <p class="text-center text-gray-700 dark:text-gray-300 mb-8 text-base md:text-lg">
        æ­£åœ¨ä¸ºæ‚¨è·³è½¬åˆ°ç›®æ ‡é¡µé¢ï¼Œè¯·ç¨ç­‰...
      </p>

      <!-- æ“ä½œæŒ‰é’®åŒºåŸŸ -->
      <div class="flex flex-col sm:flex-row gap-8 justify-center items-center mt-8">
        <!-- æ‰‹åŠ¨è·³è½¬é“¾æ¥ -->
        <a 
          id="redirectLink" 
          href="#" 
          class="no-style px-16 py-4 bg-primary text-white font-bold text-lg rounded-full hover:bg-primary/90 active:scale-95 transition-all duration-200 shadow-lg hover:shadow-xl"
        >
          ç«‹å³è·³è½¬
        </a>

        <!-- å–æ¶ˆæŒ‰é’® -->
        <button 
          id="cancelBtn" 
          class="px-16 py-4 bg-gray-300 dark:bg-gray-600 text-gray-900 dark:text-white font-bold text-lg rounded-full hover:bg-gray-400 dark:hover:bg-gray-500 active:scale-95 transition-all duration-200 shadow-md hover:shadow-lg"
        >
          å–æ¶ˆ
        </button>
      </div>

      <!-- å¤‡æ³¨ä¿¡æ¯ -->
      <p class="text-center text-xs text-gray-500 dark:text-gray-400 mt-12">
        å¦‚æœé¡µé¢æœªèƒ½è‡ªåŠ¨è·³è½¬ï¼Œè¯·ç‚¹å‡»ä¸Šæ–¹"ç«‹å³è·³è½¬"æŒ‰é’®
      </p>
    </main>
    <Footer />

    <script>
      // è·å– URL å‚æ•°
      const urlParams = new URLSearchParams(window.location.search);
      const url = urlParams.get('url') || '';
      const stop = urlParams.get('stop') === 'true';
      const isNew = urlParams.get('isNew') === 'true';
      
      // å¦‚æœæ²¡æœ‰ url å‚æ•°ï¼Œè·³è½¬è‡³é¦–é¡µ
      if (!url) {
        window.location.href = '/';
      } else {
        // è®¾ç½® URL æ˜¾ç¤ºå’Œé“¾æ¥
        const urlDisplay = document.getElementById('urlDisplay');
        const redirectLink = document.getElementById('redirectLink');
        
        if (urlDisplay) {
          urlDisplay.textContent = url;
        }
        if (redirectLink) {
          redirectLink.href = url;
        }
        
        // å¦‚æœ isNew=trueï¼Œç«‹å³è·³è½¬ï¼ˆä¸ç­‰å¾…å€’è®¡æ—¶ï¼‰
        if (isNew) {
          window.location.href = url;
        } else {
          // å€’è®¡æ—¶å’Œè·³è½¬é€»è¾‘ - é»˜è®¤ 3 ç§’åè·³è½¬
          let countdown = 3;
          const countdownEl = document.getElementById('countdown');
          const cancelBtn = document.getElementById('cancelBtn');
          let redirectTimer = null;
          
          function startCountdown() {
            redirectTimer = setInterval(() => {
              countdown--;
              if (countdownEl) {
                countdownEl.textContent = countdown.toString();
              }
              
              if (countdown <= 0) {
                if (redirectTimer) clearInterval(redirectTimer);
                window.location.href = url;
              }
            }, 1000);
          }
          
          if (cancelBtn) {
            cancelBtn.addEventListener('click', () => {
              if (redirectTimer) clearInterval(redirectTimer);
              cancelBtn.textContent = 'å·²å–æ¶ˆ';
              cancelBtn.disabled = true;
              if (countdownEl) {
                countdownEl.classList.add('text-gray-400', 'dark:text-slate-500');
                countdownEl.textContent = 'å·²å–æ¶ˆ';
              }
            });
          }
          
          // å¦‚æœ stop=trueï¼Œä¸è‡ªåŠ¨è·³è½¬ï¼ˆåªæ˜¾ç¤ºé“¾æ¥ï¼‰
          if (!stop) {
            startCountdown();
          } else {
            // stop=true æ—¶éšè—å€’è®¡æ—¶å®¹å™¨
            const countdownContainer = document.getElementById('countdownContainer');
            if (countdownContainer) {
              countdownContainer.style.display = 'none';
            }
          }
        }
      }
    </script>
  </body>
</html>

