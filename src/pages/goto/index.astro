---
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../../consts';
import '../../styles/global.css';
---

<!doctype html>
<html lang="zh-CN" class="scroll-smooth">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
    <script>
      // é˜²æ­¢é—ªçƒï¼šåœ¨é¡µé¢åŠ è½½å‰è®¾ç½®ä¸»é¢˜
      const savedTheme = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const isDark = savedTheme === 'dark' || (!savedTheme && prefersDark);
      if (isDark) {
        document.documentElement.classList.add('dark');
      }
    </script>
  </head>
  <body>
    <Header />
    <main class="w-full max-w-285 mx-auto px-4 py-12">
      <h1 class="text-5xl font-bold mb-6">ğŸŒ€ é¡µé¢è·³è½¬ä¸­...</h1>
      <p class="mb-4">
        æ­£åœ¨ä¸ºæ‚¨è·³è½¬åˆ°ç›®æ ‡é¡µé¢ï¼Œè¯·ç¨å€™ç‰‡åˆ»ã€‚
      </p>
      <p class="mb-6">
        <strong>ç›®æ ‡åœ°å€ï¼š</strong><br />
        <code class="bg-primary/10 dark:bg-primary/20 px-2 py-1 rounded text-gray-800 dark:text-gray-200 break-all" id="urlDisplay">è·å–ä¸­...</code>
      </p>
      <div class="mb-6 p-4 bg-primary/10 dark:bg-primary/20 border-l-4 border-primary rounded">
        <p class="text-lg font-bold text-gray-900 dark:text-white mb-2">
          å€’è®¡æ—¶ï¼š<span id="countdown" class="text-3xl text-primary">3</span> ç§’
        </p>
      </div>
      <p class="mb-6">
        å¦‚æœé¡µé¢æœªèƒ½è‡ªåŠ¨è·³è½¬ï¼Œè¯·
        <a id="redirectLink" href="#" class="underline decoration-primary hover:decoration-primary hover:bg-primary/10 transition-colors rounded px-1">ç‚¹å‡»è¿™é‡Œ</a>
        æ‰‹åŠ¨è·³è½¬ã€‚
      </p>
      <p class="mb-4">
        <button id="cancelBtn" class="px-4 py-2 bg-primary/20 hover:bg-primary/30 dark:bg-primary/30 dark:hover:bg-primary/40 text-gray-800 dark:text-white rounded transition-colors">
          å–æ¶ˆè·³è½¬
        </button>
      </p>
    </main>
    <Footer />

    <script>
      // è·å– URL å‚æ•°
      const urlParams = new URLSearchParams(window.location.search);
      const url = urlParams.get('url') || '';
      const stop = urlParams.get('stop') === 'true';
      const isNew = urlParams.get('isNew') === 'true';
      
      // å¦‚æœæ²¡æœ‰ url å‚æ•°ï¼Œè·³è½¬è‡³é¦–é¡µ
      if (!url) {
        window.location.href = '/';
      } else {
        // è®¾ç½® URL æ˜¾ç¤ºå’Œé“¾æ¥
        const urlDisplay = document.getElementById('urlDisplay');
        const redirectLink = document.getElementById('redirectLink');
        
        if (urlDisplay) {
          urlDisplay.textContent = url;
        }
        if (redirectLink) {
          redirectLink.href = url;
        }
        
        // å¦‚æœ isNew=trueï¼Œç«‹å³è·³è½¬ï¼ˆä¸ç­‰å¾…å€’è®¡æ—¶ï¼‰
        if (isNew) {
          window.location.href = url;
        } else {
          // å€’è®¡æ—¶å’Œè·³è½¬é€»è¾‘ - é»˜è®¤ 3 ç§’åè·³è½¬
          let countdown = 3;
          const countdownEl = document.getElementById('countdown');
          const cancelBtn = document.getElementById('cancelBtn');
          let redirectTimer = null;
          
          function startCountdown() {
            redirectTimer = setInterval(() => {
              countdown--;
              if (countdownEl) {
                countdownEl.textContent = countdown.toString();
              }
              
              if (countdown <= 0) {
                if (redirectTimer) clearInterval(redirectTimer);
                window.location.href = url;
              }
            }, 1000);
          }
          
          if (cancelBtn) {
            cancelBtn.addEventListener('click', () => {
              if (redirectTimer) clearInterval(redirectTimer);
              cancelBtn.textContent = 'å·²å–æ¶ˆ';
              cancelBtn.disabled = true;
              if (countdownEl) {
                countdownEl.classList.add('text-gray-400', 'dark:text-slate-500');
                countdownEl.textContent = 'å·²å–æ¶ˆ';
              }
            });
          }
          
          // å¦‚æœ stop=trueï¼Œä¸è‡ªåŠ¨è·³è½¬ï¼ˆåªæ˜¾ç¤ºé“¾æ¥ï¼‰
          if (!stop) {
            startCountdown();
          } else {
            // stop=true æ—¶éšè—å€’è®¡æ—¶
            const countdownDiv = document.querySelector('.mb-6 p-4');
            if (countdownDiv) {
              countdownDiv.style.display = 'none';
            }
          }
        }
      }
    </script>
  </body>
</html>

