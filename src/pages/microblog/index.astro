---
import { getCollection, render } from "astro:content";
import MicroblogLayout from "../../layouts/MicroblogLayout.astro";
import { filterContent } from "../../utils";

const allPosts = filterContent(await getCollection("blog"), 'microblog')
  .sort((a, b) => b.data.date?.valueOf() - a.data.date?.valueOf());

const latestPosts = allPosts.slice(0, 30);

const posts = await Promise.all(
  latestPosts.map(async (post) => ({
    ...post,
    html: await render(post),
  }))
);

// Speculation Rules: prerender common navigation pages
const speculationUrls = [
  "/",           // Home page
  "/post",       // Posts listing
  "/categories", // Categories
  "/tags",       // Tags
  "/archives",   // Archives
];
---

<MicroblogLayout 
  title="Microblog" 
  posts={posts}
  speculationUrls={speculationUrls}
  speculationEagerness="moderate"
/>
